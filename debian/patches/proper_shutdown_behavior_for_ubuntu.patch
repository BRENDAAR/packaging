## Description: Fixes up the shutdown behavior so users can't break it
## Origin/Author: Mario Limonciello
## Upstream URL: http://svn.mythtv.org/trac/ticket/9102
Index: mythtv-trunk/mythtv/programs/mythfrontend/exitprompt.cpp
===================================================================
--- mythtv-trunk~/mythtv/programs/mythfrontend/exitprompt.cpp	2010-08-29 17:22:36.000000000 -0500
+++ mythtv-trunk/mythtv/programs/mythfrontend/exitprompt.cpp	2010-08-30 14:28:13.827122595 -0500
@@ -12,6 +12,7 @@
 #include "mythmainwindow.h"
 #include "mythscreenstack.h"
 #include "mythsystem.h"
+#include "mythverbose.h"
 
 void ExitPrompter::quit()
 {
@@ -64,10 +65,16 @@
 {
 
     QString halt_cmd = gCoreContext->GetSetting("HaltCommand","");
+    int ret = -1;
     if (!halt_cmd.isEmpty()) /* Use user specified command if it exists */
     {
-        myth_system(halt_cmd);
-    } else if (!DBusHalt()) /* If supported, use DBus to shutdown */
+        ret = myth_system(halt_cmd);
+        if (ret != 0)
+        {
+            VERBOSE(VB_IMPORTANT, "User defined HaltCommand failed, falling back to alternative methods.");
+        }
+    }
+    if (ret != 0 && !DBusHalt()) /* If supported, use DBus to shutdown */
     {
         myth_system("sudo /sbin/halt -p"); 
     }
@@ -120,10 +127,16 @@
 {
 
     QString reboot_cmd = gCoreContext->GetSetting("RebootCommand","");
+    int ret = -1;
     if (!reboot_cmd.isEmpty()) /* Use user specified command if it exists */
     {
-        myth_system(reboot_cmd);
-    } else if (!DBusReboot()) /* If supported, use DBus to reboot */
+        ret = myth_system(reboot_cmd);
+        if (ret != 0)
+        {
+            VERBOSE(VB_IMPORTANT, "User defined RebootCommand failed, falling back to alternative methods.");
+        }
+    }
+    if (ret != 0 && !DBusReboot()) /* If supported, use DBus to reboot */
     {
         myth_system("sudo /sbin/reboot");
     }
